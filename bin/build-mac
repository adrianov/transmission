#!/usr/bin/env bash
set -euo pipefail

root_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
build_dir="${root_dir}/build"
app_path="${build_dir}/macosx/Transmission.app"

cmake -B "${build_dir}" -G Ninja -DCMAKE_BUILD_TYPE=Release
cmake --build "${build_dir}" -t transmission-mac -j"$(sysctl -n hw.ncpu)"

if [[ -d "${app_path}" ]]; then
    open -R "${app_path}"
else
    open "${build_dir}/macosx"
fi
